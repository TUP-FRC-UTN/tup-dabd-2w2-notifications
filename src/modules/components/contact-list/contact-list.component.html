<!-- contact-table.component.html -->
<div class="container mt-4">
  <!-- Primera fila: Botones de exportación -->
  <div class="row mb-3">
    <div class="col-12 text-end">
      <button class="btn btn-outline-success me-2">
        <i class="bi bi-file-excel me-1"></i>Excel
      </button>
      <button class="btn btn-outline-danger me-2">
        <i class="bi bi-file-pdf me-1"></i>PDF
      </button>
    </div>
  </div>

  <!-- Segunda fila: Barra de búsqueda -->
  <div class="row mb-3">
    <div class="col-md-12">
      <div class="input-group">
        <span class="input-group-text">
          <i class="bi bi-search"></i>
        </span>
        <span class="input-group-text border-start-0">
          Buscar
        </span>
        <input [(ngModel)]="searchTerm" (input)="onSearchTextChange(searchTerm)"   type="text" class="form-control" placeholder="Buscar contacto..." [(ngModel)]="searchTerm">
        
        <button class="btn btn-outline-secondary" title="Limpiar filtros">
          <i class="bi bi-trash"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Tercera fila: Filtros de estado -->
  <div class="row mb-3">
    <div class="col-12 text-end">
      <div class="btn-group">
        <button class="btn btn-outline-primary" (click)="filterByStatus('all')" >Todos</button>
        <button class="btn btn-outline-success" (click)="filterByStatus('active')">Activos</button>
        <button class="btn btn-outline-secondary" (click)="filterByStatus('inactive')">Inactivos</button>
      </div>
    </div>
  </div>

  <!-- Tabla -->
  <div class="table-responsive">
    <table class="table table-striped table-bordered">
      <thead class="table-dark">
        <tr>
          <th>Contacto</th>
          <th>Tipo de Contacto</th>
          <th>Suscripciones</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for(contact of contacts; track contact.id){
        <tr>
          <td>{{contact.contactValue}}</td>
          <td>{{contact.contactType}}</td>
          <td>
            @if(contact.subscriptions.length > 0){
            <div class="subscription-list">
              @for(subscription of contact.subscriptions; track $index){
              <div class="subscription-item">
                <i class="bi bi-dot"></i> {{subscription}}
              </div>
              }
            </div>
            } @else {
            <span class="text-muted">Sin suscripciones</span>
            }
          </td>
          <td>
            <button class="btn btn-primary btn-sm me-1" (click)="openEditModal(contact)">
              <i class="bi bi-pencil"></i>
            </button>


            <button class="btn btn-danger btn-sm me-1" (click)="openDeleteModal(contact)">
              <i class="bi bi-trash"></i>
            </button>
            <button class="btn btn-success btn-sm" (click)="saveContact()">
              <i class="bi bi-plus-lg"></i>
            </button>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>



  <!-- Última fila: Paginador e Información -->
  <div class="row align-items-center">
    <div class="col-md-6">
      <select class="form-select w-auto" [(ngModel)]="itemsPerPage" (change)="onItemsPerPageChange()">
        <option [value]="10">10</option>
        <option [value]="25">25</option>
        <option [value]="50">50</option>
      </select>
    </div>
    <div class="col-md-6">
      <div class="d-flex justify-content-end align-items-center">
        <nav class="me-3">
          <ul class="pagination mb-0">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <a class="page-link" (click)="changePage(currentPage - 1)">Anterior</a>
            </li>
            @for(page of pages; track page){
            <li class="page-item" [class.active]="currentPage === page">
              <a class="page-link" (click)="changePage(page)">{{page}}</a>
            </li>
            }
            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <a class="page-link" (click)="changePage(currentPage + 1)">Siguiente</a>
            </li>
          </ul>
        </nav>
        <button class="btn btn-outline-secondary">
          <i class="bi bi-info-circle"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Mensaje -->
<div [class.show]="isModalOpen" [style.display]="isModalOpen ? 'block' : 'none'" class="modal fade" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ modalTitle }}</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <p>{{ modalMessage }}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" (click)="closeModal()">Aceptar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Edición -->
<div [class.show]="isEditModalOpen" [style.display]="isEditModalOpen ? 'block' : 'none'" class="modal fade"
  tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Editar Contacto</h5>
        <button type="button" class="btn-close" (click)="closeEditModal()"></button>
      </div>
      <div class="modal-body">
        <form #editForm="ngForm">
          <!-- Tipo de Contacto -->
          <div class="mb-3">
            <label for="contactType" class="form-label">Tipo de Contacto</label>
            <select class="form-select" id="contactType" name="contactType" [(ngModel)]="editingContact.contactType"
              required>
              <option value="Email">Email</option>
              <option value="Phone">Teléfono</option>
            </select>
          </div>

          <!-- Valor del Contacto -->
          <div class="mb-3">
            <label for="contactValue" class="form-label">Valor del Contacto</label>
            <input type="text" class="form-control" id="contactValue" name="contactValue"
              [(ngModel)]="editingContact.contactValue" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeEditModal()">Cancelar</button>
        <button type="button" class="btn btn-primary" (click)="saveEditedContact()" [disabled]="!editForm.form.valid">
          Aceptar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Backdrops para los modales -->
@if(isModalOpen){
<div class="modal-backdrop fade show"></div>
}
@if(isEditModalOpen){
<div class="modal-backdrop fade show"></div>
}


<div [class.show]="isDeleteModalOpen" [style.display]="isDeleteModalOpen ? 'block' : 'none'"
  class="modal fade delete-modal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirmar Eliminación</h5>
        <button type="button" class="btn-close" (click)="closeDeleteModal()"></button>
      </div>
      <div class="modal-body">
        @if(contactToDelete){
        <p>¿Está seguro que desea eliminar el siguiente contacto?</p>
        <div class="contact-details mt-3">
          <p><strong>Tipo de Contacto:</strong> {{contactToDelete.contactType}}</p>
          <p><strong>Valor:</strong> {{contactToDelete.contactValue}}</p>
          @if(contactToDelete.subscriptions.length > 0){
          <p><strong>Suscripciones:</strong></p>
          <ul class="list-unstyled">
            @for(subscription of contactToDelete.subscriptions; track $index){
            <li><i class="bi bi-dot"></i> {{subscription}}</li>
            }
          </ul>
          }
        </div>
        } @else {
        <p>No se ha seleccionado ningún contacto para eliminar.</p>
        }
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeDeleteModal()">Cancelar</button>
        <button type="button" class="btn btn-danger" (click)="confirmDelete()" [disabled]="!contactToDelete">
          Eliminar
        </button>
      </div>
    </div>
  </div>
</div>
