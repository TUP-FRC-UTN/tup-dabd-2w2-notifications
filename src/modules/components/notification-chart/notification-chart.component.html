<app-main-container title="Estadisticas de Notificaciones" (infoButtonClick)="showInfo()">

  <div class="d-flex justify-content-between align-items-center mb-3">

    @if (isBrowser) {
    <div class="container-fluid p-4">
      <!-- KPIs Row -->
      <div class="row mb-4">
        <h2 class="h4 mb-3">KPIs</h2>
        <!-- Success Rate KPI -->
        <div class="col-md-3 mb-3">
          <div class="card">
            <div class="card-body">
              <div class="d-flex align-items-center mb-2">
                <div class="icon-circle bg-success text-white me-3">
                  <i class="bi bi-check-circle"></i>
                </div>
                <h6 class="card-subtitle text-muted mb-0">Tasa de Éxito</h6>
              </div>
              <h2 class="card-title mb-0 text-success">{{kpis.successRate | number:'1.0-1'}}%</h2>
              <small class="text-muted">Notificaciones enviadas exitosamente</small>
            </div>
          </div>
        </div>

        <!-- Daily Average KPI -->
        <div class="col-md-3 mb-3">
          <div class="card">
            <div class="card-body">
              <div class="d-flex align-items-center mb-2">
                <div class="icon-circle bg-primary text-white me-3">
                  <i class="bi bi-graph-up"></i>
                </div>
                <h6 class="card-subtitle text-muted mb-0">Promedio Diario</h6>
              </div>
              <h2 class="card-title mb-0">{{kpis.dailyAverage | number:'1.0-1'}}</h2>
              <small class="text-muted">Notificaciones por día</small>
            </div>
          </div>
        </div>

        <!-- Most Used Template KPI -->
        <div class="col-md-3 mb-3">
          <div class="card">
            <div class="card-body">
              <div class="d-flex align-items-center mb-2">
                <div class="icon-circle bg-warning text-white me-3">
                  <i class="bi bi-file-text"></i>
                </div>
                <h6 class="card-subtitle text-muted mb-0">Plantilla más Usada</h6>
              </div>
              <h2 class="card-title mb-0">{{kpis.mostUsedTemplate.count}}</h2>
              <small class="text-muted">{{kpis.mostUsedTemplate.name}}</small>
            </div>
          </div>
        </div>

        <!-- Peak Hour KPI -->
        <div class="col-md-3 mb-3">
          <div class="card">
            <div class="card-body">
              <div class="d-flex align-items-center mb-2">
                <div class="icon-circle bg-info text-white me-3">
                  <i class="bi bi-clock"></i>
                </div>
                <h6 class="card-subtitle text-muted mb-0">Hora Pico</h6>
              </div>
              <h2 class="card-title mb-0">{{kpis.peakHour.hour}}:00</h2>
              <small class="text-muted">{{kpis.peakHour.count}} notificaciones</small>
            </div>
          </div>
        </div>
      </div>



        <div style="margin-bottom: 15px;">


            <h2 class="h4 mb-3">Graficos</h2>
        

        </div>
        <div class="btn-group me-5" role="group">
          <button class="btn btn-outline-info position-relative" type="button" (click)="toggleDropdown()">
            <div class="icon-container">
              <i class="bi bi-funnel-fill"></i>
              <i class="bi bi-caret-down-fill"></i>
              <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary">
                {{ getActiveFiltersCount() }}
              </span>
            </div>
          </button>
        </div>


      <!-- Filter Dropdown -->
      <div class="dropdown">
        <div class="dropdown-menu dropdown-menu-end p-3" [ngClass]="{'show': isDropdownOpen}">
          <!-- Asunto -->
          <div class="mb-3">
            <label class="form-label">Asunto</label>
            <input type="text" class="form-control" placeholder="Buscar por asunto..." [(ngModel)]="searchSubject">
          </div>

          <!-- Usuario -->
          <div class="mb-3">
            <label class="form-label">Usuario</label>
            <input type="text" class="form-control" placeholder="Buscar por email de destinatario..."
              [(ngModel)]="searchEmail">
          </div>

          <!-- Estado -->
          <div class="mb-3">
            <label class="form-label">Estado</label>
            <select class="form-select" [(ngModel)]="selectedStatus">
              <option value="ALL">Todas</option>
              <option value="SENT">Enviadas</option>
              <option value="VISUALIZED">Vistas</option>
            </select>
          </div>

          <!-- Fecha desde -->
          <div class="mb-3">
            <label class="form-label">Fecha desde:</label>
            <input type="date" class="form-control" [(ngModel)]="dateFrom">
          </div>

          <!-- Fecha hasta -->
          <div class="mb-3">
            <label class="form-label">Fecha hasta:</label>
            <input type="date" class="form-control" [(ngModel)]="dateUntil">
          </div>

          <!-- Action Buttons -->
          <div class="d-flex gap-2">
            <button class="btn btn-outline-danger w-50" (click)="resetFilters()">
              <i class="bi bi-trash"></i>
            </button>
            <button class="btn btn-outline-primary w-50" (click)="applyFilters()">
              <i class="bi bi-search"></i>
            </button>
          </div>
        </div>
      </div>

      <br>

      <!-- Charts -->
      <div class="row">
        <!-- Daily Notifications Chart -->
        <div class="col-12 mb-4">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title text-center">Notificaciones por Día</h5>
              <div class="chart-container">
                <canvas baseChart #dailyChart="base-chart" [data]="dailyChartData" [options]="dailyChartOptions"
                  [type]="'line'">
                </canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Status Chart -->
        <div class="col-md-6 mb-4">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title text-center">Estado de Notificaciones</h5>
              <div class="chart-container">
                <canvas baseChart #statusChart="base-chart" [data]="statusChartData" [options]="statusChartOptions"
                  [type]="'pie'">
                </canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Template Usage Chart -->
        <div class="col-md-6 mb-4">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title text-center">Uso de Plantillas</h5>
              <div class="chart-container">
                <canvas baseChart #templateChart="base-chart" [data]="templateChartData"
                  [options]="templateChartOptions" [type]="'bar'">
                </canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    }
  </div>
</app-main-container>
